<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Track Your Order</title>
    <link rel="stylesheet" href="allinone.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous"
    />
    <style>
      :root {
        --brand: #ff7a00;
        --muted: #f3f3f3;
        --text: #222;
        --accent: #ffb07a;
        --danger: #e55353;
        --glass: rgba(255, 255, 255, 0.6);
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }

      .container {
        max-width: 900px;
        margin: 16px auto;
        padding: 18px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.9),
          var(--glass)
        );
        border-radius: 16px;
        box-shadow: 0 6px 30px rgba(33, 33, 33, 0.08);
      }
      header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
      }
      .brand-badge {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: linear-gradient(180deg, var(--brand), var(--accent));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 20px;
      }
      h1 {
        font-size: 20px;
        margin: 0;
      }
      p.lead {
        margin: 6px 0 18px;
        color: #555;
      }

      .stepper {
        display: flex;
        gap: 18px;
        align-items: center;
        justify-content: space-between;
        padding: 18px 6px;
        position: relative;
      }
      @media (max-width: 640px) {
        .stepper {
          flex-direction: column;
          align-items: flex-start;
          padding: 12px;
        }
      }

      .step {
        --size: 64px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        flex: 1;
        position: relative;
      }
      .step .dot {
        width: var(--size);
        height: var(--size);
        border-radius: 50%;
        border: 3px solid var(--muted);
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.28s ease;
        z-index: 2;
        font-size: 26px;
        color: #666;
      }
      .step .label {
        font-size: 13px;
        text-align: center;
        color: #444;
        max-width: 86px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin-top: 4px;
      }

      .step::after {
        content: "";
        height: 4px;
        background: var(--muted);
        position: absolute;
        top: 32px;
        left: 50%;
        right: -50%;
        z-index: 1;
        border-radius: 4px;
      }
      .step:last-child::after {
        display: none;
      }

      .step.active .dot {
        border-color: var(--brand);
        background: linear-gradient(180deg, var(--brand), var(--accent));
        color: white;
        transform: scale(1.05);
      }
      .step.done .dot {
        border-color: var(--brand);
        background: #fff;
        color: var(--brand);
      }
      .step.done::after {
        background: linear-gradient(90deg, var(--brand), var(--accent));
      }

      .meta {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-top: 18px;
      }
      .pill {
        background: var(--muted);
        padding: 8px 12px;
        border-radius: 999px;
        font-size: 13px;
      }

      .card {
        margin-top: 16px;
        background: linear-gradient(180deg, white, #fffaf3);
        padding: 14px;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(33, 33, 33, 0.04);
      }

      @media (max-width: 640px) {
        .step .label {
          max-width: 220px;
          text-align: left;
        }
        .step::after {
          left: 22px;
          top: 22px;
          height: 2px;
          width: 100%;
        }
        .step {
          flex-direction: row;
          align-items: center;
          gap: 12px;
        }
        .step .dot {
          --size: 44px;
          font-size: 20px;
        }
      }
    </style>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f9fff9;
        margin: 0;
        padding: 0;
      }

      .tracking-section {
        padding: 40px 20px;
        max-width: 1000px;
        margin: auto;
      }

      .tracking-section h1 {
        text-align: center;
        font-size: 32px;
        color: #2d6a4f;
        margin-bottom: 10px;
      }

      .order-summary {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .order-summary h3 {
        margin-bottom: 10px;
        color: #333;
      }

      .order-summary ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .order-summary li {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        color: #555;
      }

      .timeline {
        position: relative;
        margin: 20px 0;
        padding-left: 40px;
        border-left: 3px solid #1b0a0a;
      }

      .timeline-step {
        margin: 20px 0;
        position: relative;
      }

      .timeline-step::before {
        content: "";
        position: absolute;
        left: -20px;
        top: 5px;
        width: 15px;
        height: 15px;
        background: #ccc;
        border-radius: 50%;
        transition: background 0.3s;
      }

      .timeline-step.active::before {
        background: #2d6a4f;
        box-shadow: 0 0 0 4px rgba(45, 106, 79, 0.2);
      }

      .timeline-step p {
        margin: 0;
        font-size: 16px;
        color: #333;
      }

      .eta-box {
        margin-top: 20px;
        text-align: center;
        background: #2d6a4f;
        color: #fff;
        padding: 15px;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="offers">
      ðŸ”¥ 50% OFF on first order | Free Delivery above â‚¹299 ðŸ”¥
    </div>

    <header>
      <nav>
        <div class="logo"></div>
        <ul>
          <li><a href="food.html">Home</a></li>
          <li><a href="orders.html">Orders</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="cart.html">Cart</a></li>
          <li><a href="login.html">Login</a></li>
          <li><a href="track.html">Track</a></li>
        </ul>
      </nav>
    </header>

    <section>
      <div class="container">
        <header>
          <div class="brand-badge">FO</div>
          <div>
            <h1>Order #<span id="orderId">--</span></h1>
            <p class="lead">
              Delivery estimate: <strong id="eta">--</strong> â€¢
              <span id="customerName">You</span>
            </p>
          </div>
        </header>

        <div class="stepper" id="stepper">
          <div class="step" data-step="0">
            <div class="dot"><i class="fa-solid fa-receipt"></i></div>
            <div class="label">Order Received</div>
          </div>
          <div class="step" data-step="1">
            <div class="dot"><i class="fa-solid fa-bowl-food"></i></div>
            <div class="label">Preparing</div>
          </div>
          <div class="step" data-step="2">
            <div class="dot"><i class="fa-solid fa-motorcycle"></i></div>
            <div class="label">Out for Delivery</div>
          </div>
          <div class="step" data-step="3">
            <div class="dot"><i class="fa-solid fa-location-dot"></i></div>
            <div class="label">On The Way</div>
          </div>
          <div class="step" data-step="4">
            <div class="dot"><i class="fa-solid fa-check"></i></div>
            <div class="label">Delivered</div>
          </div>
        </div>

        <div class="meta">
          <div class="pill" id="statusPill">
            Status: <strong id="statusText">--</strong>
          </div>
          <div id="statusTime" style="font-size: 13px; color: #666">
            Updated: --
          </div>
        </div>

        <div class="card" id="detailsCard">
          <strong>Order Details</strong>
          <div id="orderItems"></div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-left">
          <h3>Tastefully Yours</h3>
          <p>Deliciously crafted meals delivered to your door.</p>
          <p>&copy; 2025 Tastefully Yours. All rights reserved.</p>
        </div>
        <div class="footer-right">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="food.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="orders.html">About Us</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
      </div>
    </footer>

    <script>
      const steps = document.querySelectorAll(".timeline-step");
      const etaBox = document.getElementById("eta");
      let totalDistance = 0;
      let remainingDistance = 0;

      // Google Maps Smooth Movement with Route Polyline + Dynamic ETA + Timeline Sync
      let map, riderMarker, customerMarker, routePolyline;
      let riderPath = [
        { lat: 28.6448, lng: 77.2167 }, // Start
        { lat: 28.647, lng: 77.22 },
        { lat: 28.65, lng: 77.223 },
        { lat: 28.652, lng: 77.225 }, // Destination
      ];
      let stepIndex = 0;
      let progress = 0;

      function haversineDistance(coord1, coord2) {
        const R = 6371;
        const dLat = ((coord2.lat - coord1.lat) * Math.PI) / 180;
        const dLng = ((coord2.lng - coord1.lng) * Math.PI) / 180;
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos((coord1.lat * Math.PI) / 180) *
            Math.cos((coord2.lat * Math.PI) / 180) *
            Math.sin(dLng / 2) *
            Math.sin(dLng / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
      }

      function calculateTotalDistance() {
        totalDistance = 0;
        for (let i = 0; i < riderPath.length - 1; i++) {
          totalDistance += haversineDistance(riderPath[i], riderPath[i + 1]);
        }
        remainingDistance = totalDistance;
      }

      function initMap() {
        calculateTotalDistance();

        map = new google.maps.Map(document.getElementById("map"), {
          center: riderPath[0],
          zoom: 14,
        });

        // Polyline for route
        routePolyline = new google.maps.Polyline({
          path: riderPath,
          geodesic: true,
          strokeColor: "#2d6a4f",
          strokeOpacity: 0.8,
          strokeWeight: 4,
        });
        routePolyline.setMap(map);

        riderMarker = new google.maps.Marker({
          position: riderPath[0],
          map: map,
          icon: "https://cdn-icons-png.flaticon.com/512/854/854878.png",
          title: "Delivery Partner",
        });

        customerMarker = new google.maps.Marker({
          position: riderPath[riderPath.length - 1],
          map: map,
          icon: "https://cdn-icons-png.flaticon.com/512/854/854894.png",
          title: "Customer Location",
        });

        animateRider();
      }

      function animateRider() {
        if (stepIndex >= riderPath.length - 1) {
          steps.forEach((s) => s.classList.remove("active"));
          steps[steps.length - 1].classList.add("active");
          etaBox.innerText = "Order Delivered ðŸŽ‰";
          return;
        }

        let start = riderPath[stepIndex];
        let end = riderPath[stepIndex + 1];

        let lat = start.lat + (end.lat - start.lat) * progress;
        let lng = start.lng + (end.lng - start.lng) * progress;
        riderMarker.setPosition({ lat, lng });
        map.panTo({ lat, lng });

        // Update distance & ETA
        let segmentDist = haversineDistance(start, { lat, lng });
        remainingDistance =
          totalDistance - haversineDistance(riderPath[0], { lat, lng });
        let eta = Math.ceil((remainingDistance / totalDistance) * 30);
        etaBox.innerText = `Estimated Delivery: ${eta} mins`;

        // Timeline sync
        let progressRatio = 1 - remainingDistance / totalDistance;
        steps.forEach((s, i) => s.classList.remove("active"));
        if (progressRatio < 0.25) {
          steps[0].classList.add("active");
        } else if (progressRatio < 0.5) {
          steps[1].classList.add("active");
        } else if (progressRatio < 0.9) {
          steps[2].classList.add("active");
        } else {
          steps[3].classList.add("active");
        }

        progress += 0.002; // smoother movement

        if (progress >= 1) {
          progress = 0;
          stepIndex++;
        }

        requestAnimationFrame(animateRider);
      }
    </script>
    <script>
      (function () {
        const steps = Array.from(document.querySelectorAll(".step"));
        const statusText = document.getElementById("statusText");
        const statusTime = document.getElementById("statusTime");
        const orderItemsDiv = document.getElementById("orderItems");
        const orderIdSpan = document.getElementById("orderId");

        let current = 0;
        let intervalId = null;

        function statusToIndex(status) {
          switch (status) {
            case "Order Received":
              return 0;
            case "Preparing":
              return 1;
            case "Out for Delivery":
              return 2;
            case "On The Way":
              return 3;
            case "Delivered":
              return 4;
            default:
              return 0;
          }
        }

        function loadOrder() {
          const data = JSON.parse(localStorage.getItem("orders")) || [];
          orderItemsDiv.innerHTML = "";

          if (data.length === 0) {
            orderItemsDiv.textContent = "No recent orders found.";
            return;
          }

          const recentOrder = data[data.length - 1];
          orderIdSpan.textContent = recentOrder.id;

          // restore status from saved order
          if (recentOrder.status) {
            current = statusToIndex(recentOrder.status);
          }

          recentOrder.items.forEach((product) => {
            const div = document.createElement("p");
            div.textContent = `${product.name} â€¢ â‚¹${product.price} Ã— ${product.quantity}`;
            orderItemsDiv.appendChild(div);
          });

          const dateDiv = document.createElement("p");
          dateDiv.style.fontWeight = "bold";
          dateDiv.textContent = `Order Date: ${recentOrder.date}`;
          orderItemsDiv.appendChild(dateDiv);
        }

        function render() {
          steps.forEach((el, i) => {
            el.classList.remove("active", "done");
            if (i < current) el.classList.add("done");
            if (i === current) el.classList.add("active");
          });
          const labels = steps.map((s) => s.querySelector(".label").textContent);
          statusText.textContent = labels[current] || "Unknown";
          statusTime.textContent =
            "Updated: " + new Date().toLocaleTimeString();
        }

        function goTo(i) {
          current = Math.max(0, Math.min(i, steps.length - 1));
          render();

          // save status to latest order
          let orders = JSON.parse(localStorage.getItem("orders")) || [];
          if (orders.length > 0) {
            orders[orders.length - 1].status =
              steps[current].querySelector(".label").textContent;
            localStorage.setItem("orders", JSON.stringify(orders));
          }

          if (current === steps.length - 1) {
            clearInterval(intervalId); // stop auto-increment if delivered
          }
        }

        loadOrder();
        render();

        if (current < steps.length - 1) {
          intervalId = setInterval(() => {
            if (current < steps.length - 1) {
              goTo(current + 1);
            }
          }, 5000);
        }
      })();
    </script>
  </body>
</html>
